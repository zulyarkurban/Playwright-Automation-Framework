{"version":3,"file":"sharding_plugin.js","sourceRoot":"","sources":["../../src/sharding/sharding_plugin.ts"],"names":[],"mappings":";;;AAGa,QAAA,cAAc,GAAwC;IACjE,IAAI,EAAE,QAAQ;IACd,WAAW,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,EAAE,EAAE;QACrC,EAAE,CAAC,gBAAgB,EAAE,KAAK,EAAE,UAAU,EAAE,EAAE;YACxC,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBACnB,OAAO,UAAU,CAAA;YACnB,CAAC;YAED,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC/D,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,EAAE,EAAE,CAAC,GAAG,CAAC,CAAA;YAClD,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,EAAE,EAAE,CAAC,CAAA;YAE9C,OAAO,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,UAAU,KAAK,UAAU,CAAC,CAAA;QACnE,CAAC,CAAC,CAAA;IACJ,CAAC;CACF,CAAA","sourcesContent":["import { InternalPlugin } from '../plugin'\nimport { ISourcesCoordinates } from '../api'\n\nexport const shardingPlugin: InternalPlugin<ISourcesCoordinates> = {\n  type: 'plugin',\n  coordinator: async ({ on, options }) => {\n    on('pickles:filter', async (allPickles) => {\n      if (!options.shard) {\n        return allPickles\n      }\n\n      const [shardIndexStr, shardTotalStr] = options.shard.split('/')\n      const shardIndex = parseInt(shardIndexStr, 10) - 1\n      const shardTotal = parseInt(shardTotalStr, 10)\n\n      return allPickles.filter((_, i) => i % shardTotal === shardIndex)\n    })\n  },\n}\n"]}